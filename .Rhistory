x = ~Date,
y = ~vol_garch_ged,
type = "scatter",
mode = "lines",
name = "GARCH GED"
)
# Unir las tres gráficas en un solo bloque
subplot(
g1, g2, g3,
nrows = 3,
shareX = TRUE,
titleY = TRUE
) %>%
layout(
title = "Comparación de volatilidades GARCH simétricas – Fondo QQQ (MXN)",
xaxis  = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis2 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis3 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
yaxis  = list(title = "GARCH Normal"),
yaxis2 = list(title = "GARCH t-Student"),
yaxis3 = list(title = "GARCH GED")
)
# Plano 1: GJR-GARCH Normal
g1 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_gjr_norm,
type = "scatter",
mode = "lines",
name = "GJR-GARCH Normal"
)
# Plano 2: GJR-GARCH t-Student
g2 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_gjr_t,
type = "scatter",
mode = "lines",
name = "GJR-GARCH t-Student"
)
# Plano 3: GJR-GARCH GED
g3 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_gjr_ged,
type = "scatter",
mode = "lines",
name = "GJR-GARCH GED"
)
# Unir en un solo bloque
subplot(
g1, g2, g3,
nrows = 3,
shareX = TRUE,
titleY = TRUE
) %>%
layout(
title = "Comparación de volatilidades GJR-GARCH – Fondo QQQ (MXN)",
xaxis  = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis2 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis3 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
yaxis  = list(title = "GJR-GARCH Normal"),
yaxis2 = list(title = "GJR-GARCH t-Student"),
yaxis3 = list(title = "GJR-GARCH GED")
)
tabla_modelos <- tibble(
Modelo = c(
"GARCH Normal",
"GARCH t-Student",
"GARCH GED",
"GJR-GARCH Normal",
"GJR-GARCH t-Student",
"GJR-GARCH GED"
),
LogLik = c(
likelihood(fit_garch),
likelihood(fit_garch_t),
likelihood(fit_garch_ged),
likelihood(fit_gjr_norm),
likelihood(fit_gjr_t),
likelihood(fit_gjr_ged)
),
AIC = c(
infocriteria(fit_garch)[1],
infocriteria(fit_garch_t)[1],
infocriteria(fit_garch_ged)[1],
infocriteria(fit_gjr_norm)[1],
infocriteria(fit_gjr_t)[1],
infocriteria(fit_gjr_ged)[1]
),
BIC = c(
infocriteria(fit_garch)[2],
infocriteria(fit_garch_t)[2],
infocriteria(fit_garch_ged)[2],
infocriteria(fit_gjr_norm)[2],
infocriteria(fit_gjr_t)[2],
infocriteria(fit_gjr_ged)[2]
)
)
datatable(
tabla_modelos %>% arrange(AIC),
options = list(pageLength = 10),
caption = "Comparación cuantitativa de modelos de volatilidad (QQQ en MXN)"
)
# Liberías de yahoo finance de Github:
source("https://raw.githubusercontent.com/OscarVDelatorreTorres/yahooFinance/main/datosMultiplesYahooFinance.R")
# Librerías de cuantificación de riesgos en Github:
source("https://raw.githubusercontent.com/OscarVDelatorreTorres/riskManagementSuiteR/refs/heads/main/riskManagementSuiteFunctions.R")
# Librerías de uso general:
library(plotly)
library(dplyr)
library(tseries)
library(quantmod)
library(tidyverse)
library(tibble)
library(forecast)
library(DT)
library(rugarch)
tickerV=c("QQQ")
deD=Sys.Date()-(3*365)
hastaD=Sys.Date()
per="D"
paridadFX="USDMXN=X"
convertirFX=c(TRUE) # Convertimos de USD a MXN
Datos=historico_multiples_precios(tickers=tickerV,de=deD,hasta=hastaD,periodicidad=per,fxRate=paridadFX,whichToFX=convertirFX)
precios=Datos$tablaPrecios
rendimientos=Datos$tablaRendimientosCont
datatable(
rendimientos %>%
mutate(QQQ = round(QQQ * 100, 4)) %>%
rename(`Rendimiento (%)` = QQQ),
options = list(pageLength = 10),
caption = 'Tabla de rendimientos diarios deL fondo QQQ'
)
# Definir fechas del intervalo
fecha_inicio <- as.Date("2023-11-20")
fecha_fin    <- as.Date("2024-11-20")
# Asegurarnos de que la fecha esté en formato Date
precios <- precios %>%
mutate(Date = as.Date(Date))
rendimientos <- rendimientos %>%
mutate(Date = as.Date(Date))
# Filtrar precios
precios_filtrados <- precios %>%
filter(Date >= fecha_inicio & Date <= fecha_fin)
# Filtrar rendimientos
rendimientos_filtrados <- rendimientos %>%
filter(Date >= fecha_inicio & Date <= fecha_fin)
datatable(precios_filtrados)
datatable(
rendimientos_filtrados %>%
mutate(QQQ = round(QQQ * 100, 4)) %>%
rename(`Rendimiento (%)` = QQQ),
options = list(pageLength = 10),
caption = 'Rendimientos diarios del fondo QQQ (20-11-2023 a 20-11-2024)'
)
# Eliminar observaciones problemáticas
rendimientos_limpios <- rendimientos_filtrados %>%
filter(
!is.na(QQQ),
QQQ > -1
)
# Rendimientos continuamente compuestos
rend_log <- rendimientos_limpios %>%
mutate(
r_log = log(1 + QQQ)
) %>%
select(Date, r_log)
# Inversión inicial
inversion_inicial <- 500000
# Rendimientos monetarios
rend_log <- rend_log %>%
mutate(
rendimiento_mxn = inversion_inicial * r_log
)
vol_fija <- sd(rend_log$r_log, na.rm = TRUE)
vol_fija
lambda <- 0.95
n <- nrow(rend_log)
var_ewma <- numeric(n)
var_ewma[1] <- vol_fija^2
for (i in 2:n) {
var_ewma[i] <- lambda * var_ewma[i - 1] +
(1 - lambda) * rend_log$r_log[i - 1]^2
}
rend_log <- rend_log %>%
mutate(vol_ewma = sqrt(var_ewma))
# Vector numérico (rugarch lo exige)
r_garch <- as.numeric(rend_log$r_log)
spec_garch <- ugarchspec(
variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
mean.model = list(armaOrder = c(0, 0), include.mean = TRUE),
distribution.model = "norm"
)
fit_garch <- ugarchfit(
spec = spec_garch,
data = r_garch,
solver = "hybrid"
)
rend_log <- rend_log %>%
mutate(vol_garch = as.numeric(sigma(fit_garch)))
# Comparación de MSE (Mean Squared Error)
# Usamos r^2 como proxy de la varianza realizada
mse_fija <- mean((rend_log$r_log^2 - vol_fija^2)^2, na.rm = TRUE)
mse_ewma <- mean((rend_log$r_log^2 - rend_log$vol_ewma^2)^2, na.rm = TRUE)
mse_garch <- mean((rend_log$r_log^2 - rend_log$vol_garch^2)^2, na.rm = TRUE)
comparacion <- tibble(
Modelo = c("Volatilidad fija", "EWMA", "GARCH(1,1)"),
MSE = c(mse_fija, mse_ewma, mse_garch)
)
datatable(comparacion, caption = "Comparación de Error Cuadrático Medio (MSE)")
# Gráfica 1: Volatilidad fija
g1 <- plot_ly(
data = rend_log,
x = ~Date,
y = rep(vol_fija, nrow(rend_log)),
type = "scatter",
mode = "lines",
name = "Volatilidad fija"
)
# Gráfica 2: Volatilidad EWMA
g2 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_ewma,
type = "scatter",
mode = "lines",
name = "Volatilidad EWMA"
)
# Gráfica 3: Volatilidad GARCH
g3 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_garch,
type = "scatter",
mode = "lines",
name = "Volatilidad GARCH"
)
# Subplots con fechas visibles en todos los planos
subplot(
g1, g2, g3,
nrows = 3,
shareX = TRUE,
titleY = TRUE
) %>%
layout(
title = "Comparación de modelos de volatilidad – Fondo QQQ (MXN)",
xaxis  = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis2 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis3 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
yaxis  = list(title = "Volatilidad fija"),
yaxis2 = list(title = "Volatilidad EWMA"),
yaxis3 = list(title = "Volatilidad GARCH")
)
lambda_098 <- 0.98
n <- nrow(rend_log)
var_ewma_098 <- numeric(n)
var_ewma_098[1] <- vol_fija^2
for (i in 2:n) {
var_ewma_098[i] <- lambda_098 * var_ewma_098[i - 1] +
(1 - lambda_098) * rend_log$r_log[i - 1]^2
}
rend_log <- rend_log %>%
mutate(vol_ewma_098 = sqrt(var_ewma_098))
r_garch <- as.numeric(rend_log$r_log)
spec_garch_t <- ugarchspec(
variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
mean.model = list(armaOrder = c(0, 0), include.mean = TRUE),
distribution.model = "std"
)
fit_garch_t <- ugarchfit(
spec = spec_garch_t,
data = r_garch,
solver = "hybrid"
)
rend_log <- rend_log %>%
mutate(vol_garch_t = as.numeric(sigma(fit_garch_t)))
spec_garch_ged <- ugarchspec(
variance.model = list(model = "sGARCH", garchOrder = c(1, 1)),
mean.model = list(armaOrder = c(0, 0), include.mean = TRUE),
distribution.model = "ged"
)
fit_garch_ged <- ugarchfit(
spec = spec_garch_ged,
data = r_garch,
solver = "hybrid"
)
rend_log <- rend_log %>%
mutate(vol_garch_ged = as.numeric(sigma(fit_garch_ged)))
r_garch <- as.numeric(rend_log$r_log)
spec_gjr_norm <- ugarchspec(
variance.model = list(
model = "gjrGARCH",
garchOrder = c(1, 1)
),
mean.model = list(
armaOrder = c(0, 0),
include.mean = TRUE
),
distribution.model = "norm"
)
fit_gjr_norm <- ugarchfit(
spec = spec_gjr_norm,
data = r_garch,
solver = "hybrid"
)
rend_log <- rend_log %>%
mutate(vol_gjr_norm = as.numeric(sigma(fit_gjr_norm)))
spec_gjr_t <- ugarchspec(
variance.model = list(
model = "gjrGARCH",
garchOrder = c(1, 1)
),
mean.model = list(
armaOrder = c(0, 0),
include.mean = TRUE
),
distribution.model = "std"
)
fit_gjr_t <- ugarchfit(
spec = spec_gjr_t,
data = r_garch,
solver = "hybrid"
)
rend_log <- rend_log %>%
mutate(vol_gjr_t = as.numeric(sigma(fit_gjr_t)))
spec_gjr_ged <- ugarchspec(
variance.model = list(
model = "gjrGARCH",
garchOrder = c(1, 1)
),
mean.model = list(
armaOrder = c(0, 0),
include.mean = TRUE
),
distribution.model = "ged"
)
fit_gjr_ged <- ugarchfit(
spec = spec_gjr_ged,
data = r_garch,
solver = "hybrid"
)
rend_log <- rend_log %>%
mutate(vol_gjr_ged = as.numeric(sigma(fit_gjr_ged)))
# Plano 1: Volatilidad fija
g1 <- plot_ly(
data = rend_log,
x = ~Date,
y = rep(vol_fija, nrow(rend_log)),
type = "scatter",
mode = "lines",
name = "Volatilidad fija"
)
# Plano 2: EWMA lambda = 0.94
g2 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_ewma,
type = "scatter",
mode = "lines",
name = "EWMA (λ = 0.95)"
)
# Plano 3: EWMA lambda = 0.98
g3 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_ewma_098,
type = "scatter",
mode = "lines",
name = "EWMA (λ = 0.98)"
)
# Unir en un solo bloque con 3 planos
subplot(
g1, g2, g3,
nrows = 3,
shareX = TRUE,
titleY = TRUE
) %>%
layout(
title = "Comparación de volatilidad: Fija vs EWMA (λ = 0.95 y λ = 0.98)",
xaxis  = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis2 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis3 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
yaxis  = list(title = "Fija"),
yaxis2 = list(title = "EWMA (0.95)"),
yaxis3 = list(title = "EWMA (0.98)")
)
# Plano 1: GARCH simétrico Normal
g1 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_garch,
type = "scatter",
mode = "lines",
name = "GARCH Normal"
)
# Plano 2: GARCH simétrico t-Student
g2 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_garch_t,
type = "scatter",
mode = "lines",
name = "GARCH t-Student"
)
# Plano 3: GARCH simétrico GED
g3 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_garch_ged,
type = "scatter",
mode = "lines",
name = "GARCH GED"
)
# Unir las tres gráficas en un solo bloque
subplot(
g1, g2, g3,
nrows = 3,
shareX = TRUE,
titleY = TRUE
) %>%
layout(
title = "Comparación de volatilidades GARCH simétricas – Fondo QQQ (MXN)",
xaxis  = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis2 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis3 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
yaxis  = list(title = "GARCH Normal"),
yaxis2 = list(title = "GARCH t-Student"),
yaxis3 = list(title = "GARCH GED")
)
# Plano 1: GJR-GARCH Normal
g1 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_gjr_norm,
type = "scatter",
mode = "lines",
name = "GJR-GARCH Normal"
)
# Plano 2: GJR-GARCH t-Student
g2 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_gjr_t,
type = "scatter",
mode = "lines",
name = "GJR-GARCH t-Student"
)
# Plano 3: GJR-GARCH GED
g3 <- plot_ly(
data = rend_log,
x = ~Date,
y = ~vol_gjr_ged,
type = "scatter",
mode = "lines",
name = "GJR-GARCH GED"
)
# Unir en un solo bloque
subplot(
g1, g2, g3,
nrows = 3,
shareX = TRUE,
titleY = TRUE
) %>%
layout(
title = "Comparación de volatilidades GJR-GARCH – Fondo QQQ (MXN)",
xaxis  = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis2 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
xaxis3 = list(title = "Fecha", showticklabels = TRUE, tickformat = "%Y-%m-%d"),
yaxis  = list(title = "GJR-GARCH Normal"),
yaxis2 = list(title = "GJR-GARCH t-Student"),
yaxis3 = list(title = "GJR-GARCH GED")
)
tabla_modelos <- tibble(
Modelo = c(
"GARCH Normal",
"GARCH t-Student",
"GARCH GED",
"GJR-GARCH Normal",
"GJR-GARCH t-Student",
"GJR-GARCH GED"
),
LogLik = c(
likelihood(fit_garch),
likelihood(fit_garch_t),
likelihood(fit_garch_ged),
likelihood(fit_gjr_norm),
likelihood(fit_gjr_t),
likelihood(fit_gjr_ged)
),
AIC = c(
infocriteria(fit_garch)[1],
infocriteria(fit_garch_t)[1],
infocriteria(fit_garch_ged)[1],
infocriteria(fit_gjr_norm)[1],
infocriteria(fit_gjr_t)[1],
infocriteria(fit_gjr_ged)[1]
),
BIC = c(
infocriteria(fit_garch)[2],
infocriteria(fit_garch_t)[2],
infocriteria(fit_garch_ged)[2],
infocriteria(fit_gjr_norm)[2],
infocriteria(fit_gjr_t)[2],
infocriteria(fit_gjr_ged)[2]
)
)
datatable(
tabla_modelos %>% arrange(AIC),
options = list(pageLength = 10),
caption = "Comparación cuantitativa de modelos de volatilidad (QQQ en MXN)"
)
